{"version":3,"sources":["webpack:///webpack/bootstrap cf19569f9ae56d402025","webpack:///external \"express\"","webpack:///external \"path\"","webpack:///./server/api/services/search.service.ts","webpack:///./server/index.ts","webpack:///./server/common/env.ts","webpack:///external \"dotenv\"","webpack:///./server/common/server.ts","webpack:///external \"express-async-errors\"","webpack:///external \"body-parser\"","webpack:///external \"http\"","webpack:///external \"os\"","webpack:///external \"cors\"","webpack:///external \"cookie-parser\"","webpack:///./server/common/swagger/index.ts","webpack:///external \"swagger-express-middleware\"","webpack:///./server/common/logger.ts","webpack:///external \"pino\"","webpack:///./server/api/services/messaging.service.ts","webpack:///external \"amqplib\"","webpack:///external \"events\"","webpack:///external \"elasticsearch\"","webpack:///./server/api/services/entitiy-type.ts","webpack:///./server/api/middleware/cors.ts","webpack:///./server/routes.ts","webpack:///./server/api/controllers/search/router.ts","webpack:///./server/api/controllers/search/controller.ts"],"names":[],"mappings":"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","file":"main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 3);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap cf19569f9ae56d402025","module.exports = require(\"express\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"express\"\n// module id = 0\n// module chunks = 0","module.exports = require(\"path\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"path\"\n// module id = 1\n// module chunks = 0","import * as es from 'elasticsearch';\r\nimport * as events from 'events';\r\nimport * as uuid from 'uuid/v4';\r\nimport { EntityType } from './entitiy-type';\r\n\r\nclass SearchService {\r\n\r\n    private client;\r\n    private indexName = 'volunteero-search';\r\n    constructor(host: String) {\r\n\r\n        this.client = new es.Client({\r\n            host,\r\n            log: 'trace'\r\n        });\r\n    }\r\n\r\n    private createEsParams(entities, mode: EntityType) {\r\n\r\n        let body = [];\r\n        entities.forEach(entity => {\r\n\r\n            let moddedPush = {};\r\n            moddedPush[mode] = { _index: this.indexName, _type: 'default', _id: entity.id };\r\n            body.push(moddedPush);\r\n\r\n            switch (mode) {\r\n                case EntityType.Create:\r\n                    body.push(entity);\r\n                    break;\r\n                case EntityType.Update:\r\n                    body.push({ doc: entity });\r\n                    break;\r\n            }\r\n        });\r\n        return { body };\r\n    }\r\n\r\n    async createEntities(entities) {\r\n\r\n         await this.client.bulk(this.createEsParams(entities, EntityType.Create));\r\n    }\r\n\r\n    async updateEntities(entities) {\r\n\r\n        await this.client.bulk(this.createEsParams(entities, EntityType.Update));\r\n    }\r\n\r\n    async deleteEntities(entities) {\r\n\r\n        await this.client.bulk(this.createEsParams(entities, EntityType.Delete));\r\n    }\r\n\r\n    async search(keywords: String[], type = 'any') {\r\n\r\n        let typedQuery = false;\r\n        let q = '';\r\n        // If there is a preferred entity type, enforce it\r\n        if (type !== 'any') {\r\n\r\n            typedQuery = true;\r\n            q += `type:${type}`;\r\n        }\r\n        // If we have keywords, add each one as filter for name and description\r\n        if (keywords.length > 0) {\r\n\r\n            if (typedQuery) {\r\n\r\n                q += ' AND (';\r\n            }\r\n            q += keywords.reduce((query, keyword) => {\r\n                query += ` description:${keyword} OR name:${keyword} OR`;\r\n                return query;\r\n            }, '');\r\n            q = q.substring(0, q.length - 3);\r\n            if (typedQuery) {\r\n\r\n                q += ')';\r\n            }\r\n        }\r\n        // Do the search\r\n        const result = await this.client.search({\r\n            index: this.indexName,\r\n            q\r\n        });\r\n        // Sort and split\r\n        const sortedAndCleaned = { events: [], campaigns: [], organizations: [] };\r\n        result.hits.hits\r\n            .sort((a, b) => a._score > b._score)\r\n            .map((hit) => hit._source)\r\n            .forEach(entity => {\r\n\r\n                switch (entity.type) {\r\n                    case 'event':\r\n                    case 'organization':\r\n                    case 'campaign':\r\n                        let copy = { ...entity };\r\n                        delete copy.type;\r\n                        sortedAndCleaned[entity.type + 's'].push(copy);\r\n                        break;\r\n                }\r\n\r\n            });\r\n        return sortedAndCleaned;\r\n    }\r\n}\r\n\r\nexport default new SearchService('http://ec2-52-59-87-68.eu-central-1.compute.amazonaws.com:9200');\n\n\n// WEBPACK FOOTER //\n// ./server/api/services/search.service.ts","import './common/env';\nimport Server from './common/server';\nimport routes from './routes';\n\nconst port = parseInt(process.env.PORT);\nexport default new Server()\n  .router(routes)\n  .listen(port);\n\n\n\n// WEBPACK FOOTER //\n// ./server/index.ts","import * as dotenv from 'dotenv';\ndotenv.config();\n\n\n// WEBPACK FOOTER //\n// ./server/common/env.ts","module.exports = require(\"dotenv\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"dotenv\"\n// module id = 6\n// module chunks = 0","require('express-async-errors');\n\nimport * as express from 'express';\nimport { Application } from 'express';\nimport * as path from 'path';\nimport * as bodyParser from 'body-parser';\nimport * as http from 'http';\nimport * as os from 'os';\nimport * as cors from 'cors';\nimport * as cookieParser from 'cookie-parser';\nimport swaggerify from './swagger';\nimport l from './logger';\nimport MessagingService from '../api/services/messaging.service';\nimport SearchService from '../api/services/search.service';\nimport { corsMiddleware } from '../api/middleware/cors';\n\nconst app = express();\n\nexport default class ExpressServer {\n\n  constructor() {\n    const root = path.normalize(__dirname + '/../..');\n    app.set('appPath', root + 'client');\n    app.use(\n      cors((req, callback) => {\n        callback(null, {\n          origin: true,\n          credentials: true\n        });\n      }),\n    );\n    app.use(corsMiddleware);\n    app.use(bodyParser.json());\n    app.use(bodyParser.urlencoded({ extended: true }));\n    app.use(cookieParser(process.env.SESSION_SECRET));\n    app.use(express.static(`${root}/public`));\n\n\n    MessagingService.on('ready', () => {\n\n      function getMessagePayload(message) {\n\n        try {\n\n          let response = JSON.parse(message.content.toString());\n          return response.entities || [];\n        } catch (e) {\n\n          return [];\n        }\n      }\n\n      async function handleMessage(ch, message, operationType) {\n\n        try {\n          \n          let payload = getMessagePayload(message);\n          switch (operationType) {\n\n            case 'create':\n              await SearchService.createEntities(payload);\n              break;\n            case 'update':\n              await SearchService.updateEntities(payload);\n              break;\n            case 'delete':\n              await SearchService.deleteEntities(payload);\n              break;\n          }\n        } finally {\n\n          ch.ack(message);\n        }\n\n      }\n\n      MessagingService.subscribeToQueue('search.create', async (ch, message) => {\n\n        await handleMessage(ch, message, 'create');\n      });\n      MessagingService.subscribeToQueue('search.update', async (ch, message) => {\n\n        await handleMessage(ch, message, 'update');\n      });\n      MessagingService.subscribeToQueue('search.delete', async (ch, message) => {\n\n        await handleMessage(ch, message, 'delete');\n      });\n    })\n  }\n\n  router(routes: (app: Application) => void): ExpressServer {\n    swaggerify(app, routes);\n    return this;\n  }\n\n  listen(port: number = parseInt(process.env.PORT)): Application {\n    const welcome = port => () => l.info(`up and running in ${process.env.NODE_ENV || 'development'} @: ${os.hostname()} on port: ${port}}`);\n    http.createServer(app).listen(port, welcome(port));\n    return app;\n  }\n}\n\n\n// WEBPACK FOOTER //\n// ./server/common/server.ts","module.exports = require(\"express-async-errors\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"express-async-errors\"\n// module id = 8\n// module chunks = 0","module.exports = require(\"body-parser\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"body-parser\"\n// module id = 9\n// module chunks = 0","module.exports = require(\"http\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"http\"\n// module id = 10\n// module chunks = 0","module.exports = require(\"os\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"os\"\n// module id = 11\n// module chunks = 0","module.exports = require(\"cors\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"cors\"\n// module id = 12\n// module chunks = 0","module.exports = require(\"cookie-parser\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"cookie-parser\"\n// module id = 13\n// module chunks = 0","import * as middleware from 'swagger-express-middleware';\nimport { Application } from 'express';\nimport * as path from 'path';\n\nexport default function (app: Application, routes: (app: Application) => void) {\n  middleware(path.join(__dirname, 'Api.yaml'), app, function(err, middleware) {\n\n    // Enable Express' case-sensitive and strict options\n    // (so \"/entities\", \"/Entities\", and \"/Entities/\" are all different)\n    app.enable('case sensitive routing');\n    app.enable('strict routing');\n\n    app.use(middleware.metadata());\n    app.use(middleware.files(app, {\n      apiPath: process.env.SWAGGER_API_SPEC,\n    }));\n\n    app.use(middleware.parseRequest({\n      // Configure the cookie parser to use secure cookies\n      cookie: {\n        secret: process.env.SESSION_SECRET\n      },\n      // Don't allow JSON content over 100kb (default is 1mb)\n      json: {\n        limit: process.env.REQUEST_LIMIT\n      }\n    }));\n\n    // These two middleware don't have any options (yet)\n    app.use(\n      middleware.CORS(),\n      middleware.validateRequest());\n\n    // Error handler to display the validation error as HTML\n    app.use(function (err, req, res, next) {\n      res.status(err.status || 400).json({\n        status: err.status,\n        message: err.message.split('\\n').join(' ')\n      });\n    });\n\n    routes(app);\n  });\n}\n\n\n\n// WEBPACK FOOTER //\n// ./server/common/swagger/index.ts","module.exports = require(\"swagger-express-middleware\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"swagger-express-middleware\"\n// module id = 15\n// module chunks = 0","import * as pino from 'pino';\n\nconst l = pino({\n  name: process.env.APP_ID,\n  level: process.env.LOG_LEVEL,\n});\n\nexport default l;\n\n\n\n// WEBPACK FOOTER //\n// ./server/common/logger.ts","module.exports = require(\"pino\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"pino\"\n// module id = 17\n// module chunks = 0","import * as amqp from 'amqplib';\r\nimport * as events from 'events';\r\n\r\nclass MessagingService extends events.EventEmitter {\r\n\r\n    private readConnection;\r\n    private writeConnection;\r\n    private logging;\r\n\r\n    constructor(private amqpUrl: String) {\r\n\r\n        super();\r\n        this.init();\r\n    }\r\n\r\n    public async init() {\r\n\r\n        this.readConnection = await amqp.connect(this.amqpUrl);\r\n        this.writeConnection = await amqp.connect(this.amqpUrl);\r\n        this.emit('ready')\r\n    }\r\n\r\n    async sendMessage(message: any, exchangeName: String, routingKey: String) {\r\n\r\n        if (this.logging) {\r\n\r\n\r\n            console.log('\\n------------------------------\\n');\r\n            console.log(`Sending to ${exchangeName}:${routingKey}`);\r\n        }\r\n\r\n        const channel = await this.writeConnection.createChannel();\r\n        await channel.publish(exchangeName, routingKey, new Buffer(JSON.stringify(message)));\r\n    }\r\n\r\n    async subscribeToQueue(queueName, subscriber) {\r\n\r\n        const channel = await this.writeConnection.createChannel();\r\n        channel.consume(queueName, (message) => {\r\n\r\n            if (this.logging) {\r\n\r\n                const payload = JSON.parse(message.content.toString());\r\n                console.log(`Got message at queue ${queueName} from ${message.fields.exchange} with routing key ${message.fields.routingKey}`);\r\n                console.log(payload);\r\n            }\r\n            subscriber(channel, message);\r\n        });\r\n    }\r\n\r\n    public setLogging(enabled: boolean) {\r\n\r\n        this.logging = enabled;\r\n    }\r\n}\r\n\r\nexport default new MessagingService('amqp://qgoudwsq:vylnIAdpecjvnlHBBaq7yREurJXzIWX1@duckbill.rmq.cloudamqp.com/qgoudwsq');\n\n\n// WEBPACK FOOTER //\n// ./server/api/services/messaging.service.ts","module.exports = require(\"amqplib\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"amqplib\"\n// module id = 19\n// module chunks = 0","module.exports = require(\"events\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"events\"\n// module id = 20\n// module chunks = 0","module.exports = require(\"elasticsearch\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"elasticsearch\"\n// module id = 21\n// module chunks = 0","export enum EntityType{\r\n    Update = \"update\",\r\n    Create = \"index\",\r\n    Delete = \"delete\"\r\n}\n\n\n// WEBPACK FOOTER //\n// ./server/api/services/entitiy-type.ts","export function corsMiddleware(req, res, next) {\r\n\r\n    res.header('Access-Control-Allow-Origin', req.get('origin'));\r\n    res.header('Access-Control-Allow-Methods', 'GET,PUT,POST,DELETE');\r\n    res.header('Access-Control-Allow-Headers', 'Content-Type');\r\n\r\n    next();\r\n}\n\n\n// WEBPACK FOOTER //\n// ./server/api/middleware/cors.ts","import { Application } from 'express';\nimport searchRouter from './api/controllers/search/router';\nexport default function routes(app: Application): void {\n  app.use('/api/v1/search', searchRouter);\n};\n\n\n// WEBPACK FOOTER //\n// ./server/routes.ts","import * as express from 'express';\nimport controller from './controller'\nimport { validate } from 'express-jsonschema';\nexport default express.Router()\n    .get('/', controller.search);\n\n\n// WEBPACK FOOTER //\n// ./server/api/controllers/search/router.ts","import { Request, Response } from 'express';\r\nimport MessagingService from '../../services/messaging.service';\r\nimport SearchService from '../../services/search.service';\r\n\r\nexport class Controller {\r\n\r\n  public static allowedTypes = ['event', 'campaign', 'organization', 'any'];\r\n  async search(req: Request, res: Response) {\r\n    \r\n    const isValidInput = Controller.isValidInput(req.query);\r\n    if (!isValidInput.valid) {\r\n\r\n      return res.status(400).json({\r\n        message: 'Invalid input: ' + isValidInput.reason,\r\n        allowedType: Controller.allowedTypes.join(', ')\r\n      })\r\n    }\r\n\r\n    const keywords = req.query.keyword.split(' ');\r\n    const searchResult = await SearchService.search(keywords, req.query.type);\r\n    return res.status(200).json({ ...searchResult });\r\n  }\r\n\r\n  static isValidInput(query: any = {}): { valid: boolean, reason?: string } {\r\n\r\n    if (typeof query.type === 'undefined') {\r\n\r\n      return {\r\n        valid: false,\r\n        reason: 'No type specified'\r\n      };\r\n    }\r\n    if (typeof query.keyword === 'undefined') {\r\n\r\n      return {\r\n        valid: false,\r\n        reason: 'No keyword specified'\r\n      };\r\n    }\r\n    if (this.allowedTypes.indexOf(query.type) < 0) {\r\n\r\n      return {\r\n        valid: false,\r\n        reason: 'Type not supported'\r\n      };\r\n    }\r\n\r\n    return {\r\n      valid: true\r\n    };\r\n  }\r\n\r\n}\r\nexport default new Controller();\r\n\n\n\n// WEBPACK FOOTER //\n// ./server/api/controllers/search/controller.ts"],"sourceRoot":""}